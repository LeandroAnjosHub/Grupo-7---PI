<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="detalhes.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Detalhes de Máquina | AeroControl</title>
</head>

<body onload="informacoes()">
  <div class="tela">
    <aside class="barraLateral">
      <img src="Protótipo Dashboard.png" alt="" />
      <a class="botao" href="../arthur/">PAINEL</a>
      <a class="botao" href="cadastroMaq.html">CADASTRO</a>
      <a class="botao" onclick="limparSessao()">SAIR</a>
    </aside>

    <main class="principal">
      <h1>DETALHES DA MÁQUINA</h1>

      <div class="conteudo">
        <div class="divGrafico">
          <canvas id="usageChart" class="grafico"></canvas>
        </div>

        <div class="lateral">
          <div class="informacoes" id="cpu">
            <span><b>CPU:</b> 80%</span>
            <p>Processador: i9-14900K </p>
          </div>

          <div class="informacoes" id="ram">
            <span><b>RAM:</b> 65%</span>
            <p>Usando 9.4MB de 16MB</p>
          </div>

          <div class="informacoes" id="alerta">
            <span><b>ALERTAS</b></span>
            <p>4 alertas na última hora</p>
          </div>
        </div>
      </div>
    </main>
  </div>
</body>

</html>

<script>
  const ctx = document.getElementById("usageChart").getContext("2d");
  const usageChart = new Chart(ctx, {
    type: "line",
    data: {
      labels: Array.from({ length: 24 }, (_, i) => i),
      datasets: [
        {
          label: "CPU",
          borderColor: "#3F2182",
          backgroundColor: "#3F2182",
          fill: false,
          data: [
            60, 50, 70, 65, 85, 90, 95, 60, 70, 40, 50, 35, 75, 80, 85, 90, 95,
            50, 60, 70, 80, 90, 100, 80,
          ],
        },
        {
          label: "Memória",
          borderColor: "#7C1E6A",
          backgroundColor: "#7C1E6A",
          fill: false,
          data: [
            30, 40, 50, 55, 60, 65, 70, 40, 45, 55, 65, 50, 55, 60, 70, 75, 80,
            85, 50, 60, 70, 85, 75, 65,
          ],
        },
      ],
    },
    options: {
      scales: {
        x: {
          grid: {
            display: false
          },
          display: false,
          title: {
            display: true,
            text: "Horário do registro",
            color: "black",
          },
          ticks: {
            color: "black",
          },
        },
        y: {
          grid: {
            color: "#A8A8A8"
          },
          display: true,
          title: {
            text: "Porcentagem de uso do componente",
            color: "black",
          },
          min: 0,
          max: 100,
          ticks: {
            stepSize: 20,
            color: "black"
          },
        },
      },
      plugins: {
        legend: {
          display: true,
          labels: {
            color: "black",
          },
        },
      },
    },
  });

  function limparSessao() {
    sessionStorage.clear();
    window.location = "../index.html";
  }

  function informacoes() {
    fetch("../suporte/getInformacoes", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({

      }),
    })
      .then(function (resposta) {
        console.log("resposta:", resposta);

        if (resposta.ok) {
          resposta.json()
            .then(function (resultado) {
              console.log(resultado)

              cpu.innerHTML = `<span><b>CPU:</b> ${resultado[0].cpuPorcentagem}%</span>
            <p>Processador: ${resultado[0].processador} </p>`

              ram.innerHTML = `<span><b>RAM:</b> ${resultado[0].memoriaPorcentagem}%</span>
            <p>Usando ${resultado[0].memoriaGB}GB de ${resultado[0].ramMax}GB</p>`

              alerta.innerHTML = `<span><b>${resultado[0].alertas} ALERTAS</b></span>
            <p>Na última hora</p>`
            })
        } else {
          throw "Houve um erro ao tentar criar o select";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
  }
</script>